--------------------------------------------
Introduction to iperf3 test with PRELOAD
--------------------------------------------

This is a sample code for running iperf3 client with PRELOAD.


Compilation of PRELOAD library
--------------------------------------------
1. login in a board with LSDK(this is test on LX2160ARDB with LSDK 21.08);
2. This code is based on DPDK branch 22.11-qoriq-dev, so please install DPDK 22.11-qoriq-dev libraries first;
3. Get code and run compile.sh on the board, then libusect.so will be built at build/lib/ directory;

  $ cd xxx/libusect
  $ ./compile.sh


TEST
--------------------------------------------

1. Run iperf3 server:

	$ ifconfig eth0 1.1.1.2/24
	$ iperf3 -s


2. Run iperf3 client:

2.1 Configure DPDMUX to have two DPNI's, one with kernel and other with user-space

  $ ls-addni --no-link
  $ source /usr/local/dpdk/dpaa2/dynamic_dpl.sh dpmac.18
  $ echo dprc.2 > /sys/bus/fsl-mc/drivers/vfio-fsl-mc/unbind
  $ restool dprc disconnect dprc.2 --endpoint=dpni.3
  $ restool dpdmux create --default-if=1 --num-ifs=2 --method DPDMUX_METHOD_CUSTOM --manip=DPDMUX_MANIP_NONE --option=DPDMUX_OPT_CLS_MASK_SUPPORT --container=dprc.1
  $ restool dprc connect dprc.1 --endpoint1=dpdmux.0.0 --endpoint2=dpmac.18
  $ restool dprc connect dprc.1 --endpoint1=dpdmux.0.1 --endpoint2=dpni.2
  $ restool dprc connect dprc.1 --endpoint1=dpdmux.0.2 --endpoint2=dpni.3
  $ restool dprc assign dprc.1 --object=dpdmux.0 --child=dprc.2 --plugged=1
  $ echo dprc.2 > /sys/bus/fsl-mc/drivers/vfio-fsl-mc/bind
  $ export DPRC=dprc.2
  $ export DPDK_ENV="-c 0x1 -n 1"
  $ ifconfig eth2 1.1.1.3/24
  $ ifconfig eth2 promisc
  $ export ETH_NAME=eth2
  $ export MUX_EP_ID=2
		This value is related to "--endpoint1=dpdmux.0.2";

  Note: It may adjust the parameters according to the actual situation.

2.2 Run iperf3 test:

  $ LD_PRELOAD=./libusect.so iperf3 -c 1.1.1.2 -i 1 -t 10 -u -b 1G -l 64
