--------------------------------------------
Introduction to iperf3 test with PRELOAD
--------------------------------------------

This is a sample code for running iperf3 client with PRELOAD.


Compilation of PRELOAD library
--------------------------------------------
  $ cmake . -Bbuild -DCMAKE_BUILD_TYPE=release -DCMAKE_C_COMPILER=aarch64-linux-gnu-gcc -DDPDK_INSTALL=/your/dpdk/install/folder
  $ make -C build

TEST
--------------------------------------------

1. Run iperf3 server(Any X86 machine or LX board):

  $ ifconfig eth0 1.1.1.2/24
  $ iperf3 -s

2. Run iperf3 client on DPAA2 board with dpmac.x connected to server's eth0.

2.1 Configure DPDMUX to have two DPNI's, one with kernel and other with user-space

  $ ls-addni --no-link
	#Assume the interface created are dpni.z-ethx.
  $ source /usr/local/dpdk/dpaa2/dynamic_dpl.sh dpmac.x
	#Assume the interface created are dpmac.x-dpni.x.
  $ echo dprc.2 > /sys/bus/fsl-mc/drivers/vfio-fsl-mc/unbind
  $ restool dprc disconnect dprc.2 --endpoint=dpni.x
  $ restool dpdmux create --default-if=1 --num-ifs=2 --method DPDMUX_METHOD_CUSTOM --manip=DPDMUX_MANIP_NONE --option=DPDMUX_OPT_CLS_MASK_SUPPORT --container=dprc.1
  $ restool dprc connect dprc.1 --endpoint1=dpdmux.0.0 --endpoint2=dpmac.x
  $ restool dprc connect dprc.1 --endpoint1=dpdmux.0.1 --endpoint2=dpni.z
  $ restool dprc connect dprc.1 --endpoint1=dpdmux.0.2 --endpoint2=dpni.x
  $ restool dprc assign dprc.1 --object=dpdmux.0 --child=dprc.2 --plugged=1
  $ echo dprc.2 > /sys/bus/fsl-mc/drivers/vfio-fsl-mc/bind
  $ export DPRC=dprc.2
  $ export eal_params="-c 0x1 -n 1"
  $ export eth_name=ethx
  $ ifconfig ethx 1.1.1.3/24
  $ ifconfig ethx promisc

2.2 Run iperf3 test:

  $ LD_PRELOAD=./libusect.so iperf3 -c 1.1.1.2 -i 1 -t 10 -u -b 1G -l 64
